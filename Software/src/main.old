#include <stdio.h>
#include <Arduino.h>
#include <GxEPD2_BW.h>
#include <Fonts/FreeMonoBold9pt7b.h>

//cs 10 (16)
//busy 5 (19)
//res 8 (22)
//dc 9 (23)
//scl 6 (20)
//sda 2 (5)
#define CS_PIN (10)
#define BUSY_PIN (5)
#define RES_PIN (8)
#define DC_PIN (9)

void helloWorld();
GxEPD2_BW<GxEPD2_290_BS, GxEPD2_290_BS::HEIGHT> display(GxEPD2_290_BS(/*CS=5*/ CS_PIN, /*DC=*/ DC_PIN, /*RES=*/ RES_PIN, /*BUSY=*/ BUSY_PIN)); // DEPG0290BS 128x296, SSD1680
void setup() {
    Serial.begin(115200);
      delay(2000);
    Serial.println("Starting...");

    SPI.begin(6, 7, 2, 10);  // SCK=6, MISO=7, MOSI=2, CS=10 (hardware pins)

    display.init(115200,true,50,false);
    Serial.println("Display inited");
    helloWorld();
    display.hibernate();
}


void helloWorld() {
    display.setRotation(1);
    display.setTextColor(GxEPD_BLACK);
    display.setFont(&FreeMonoBold9pt7b);
    int16_t tbx, tby; uint16_t tbw, tbh;
    display.getTextBounds("Hello World!", 0, 0, &tbx, &tby, &tbw, &tbh);
    // center the bounding box by transposition of the origin:
    uint16_t x = ((display.width() - tbw) / 2) - tbx;
    uint16_t y = ((display.height() - tbh) / 2) - tby;
    Serial.println("Drawing 'Hello World!' at: " + String(x) + ", " + String(y));

    display.setFullWindow();
    display.firstPage();
    do {
        display.fillScreen(GxEPD_WHITE);
        display.setCursor(x, y);
        display.print("Hello World!");
    }
    while (display.nextPage());
}

void loop() {
    Serial.println("Hello World!");
    delay(10000);
}